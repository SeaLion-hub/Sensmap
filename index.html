<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sensmap - Advanced Sensory Navigation</title>
    
    <!-- 서버 URL 설정 (가장 먼저) -->
    <script>
        window.SENSMAP_SERVER_URL = 'https://sensmap-production.up.railway.app';
        console.log('서버 URL 설정:', window.SENSMAP_SERVER_URL);
    </script>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🗺️</text></svg>">
    
    <meta name="description" content="Sensmap - 감각 친화적 내비게이션을 통해 더 쾌적한 경로를 찾아보세요">
    <meta name="keywords" content="감각지도, 접근성, 내비게이션, 쾌적한경로, 감각친화적">
    <meta name="author" content="Sensmap Team">
    
    <meta property="og:title" content="Sensmap - Advanced Sensory Navigation">
    <meta property="og:description" content="감각 친화적 내비게이션을 통해 더 쾌적한 경로를 찾아보세요">
    <meta property="og:type" content="website">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch@3.11.0/dist/geosearch.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="styles.css">
    
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
</head>
<body>
    <!-- 개선된 로그인 모달 -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-map-marked-alt"></i>
                    Sensmap
                </h3>
                <div class="modal-subtitle">감각 친화적 내비게이션</div>
                <button class="close-btn" id="closeLoginBtn" aria-label="로그인 모달 닫기">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- 탭 네비게이션 -->
            <div class="auth-tabs">
                <button class="auth-tab active" id="loginTab">로그인</button>
                <button class="auth-tab" id="signupTab">회원가입</button>
            </div>

            <div class="modal-body">
                <!-- 로그인 폼 -->
                <form class="auth-form active" id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">이메일</label>
                        <input 
                            type="email" 
                            class="form-input" 
                            id="loginEmail" 
                            name="email" 
                            placeholder="example@sensmap.com" 
                            required 
                            autocomplete="email"
                        >
                        <div class="input-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">비밀번호</label>
                        <input 
                            type="password" 
                            class="form-input" 
                            id="loginPassword" 
                            name="password" 
                            placeholder="비밀번호를 입력하세요" 
                            required 
                            autocomplete="current-password"
                        >
                        <div class="input-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                    </div>
                    <button type="submit" class="auth-btn primary">
                        <i class="fas fa-sign-in-alt"></i>
                        로그인
                    </button>
                </form>

                <!-- 회원가입 폼 -->
                <form class="auth-form" id="signupForm">
                    <div class="form-group">
                        <label for="signupName">이름</label>
                        <input 
                            type="text" 
                            class="form-input" 
                            id="signupName" 
                            name="name" 
                            placeholder="홍길동" 
                            required 
                            autocomplete="name"
                            minlength="2"
                        >
                        <div class="input-icon">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="signupEmail">이메일</label>
                        <input 
                            type="email" 
                            class="form-input" 
                            id="signupEmail" 
                            name="email" 
                            placeholder="example@sensmap.com" 
                            required 
                            autocomplete="email"
                        >
                        <div class="input-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">비밀번호</label>
                        <input 
                            type="password" 
                            class="form-input" 
                            id="signupPassword" 
                            name="password" 
                            placeholder="8자 이상 입력하세요" 
                            required 
                            autocomplete="new-password"
                            minlength="8"
                        >
                        <div class="input-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <div class="password-strength">
                            <div class="password-strength-bar" id="passwordStrengthBar"></div>
                        </div>
                        <div class="password-hint" id="passwordHint">8자 이상의 비밀번호를 입력하세요</div>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">비밀번호 확인</label>
                        <input 
                            type="password" 
                            class="form-input" 
                            id="confirmPassword" 
                            name="confirmPassword" 
                            placeholder="비밀번호를 다시 입력하세요" 
                            required 
                            autocomplete="new-password"
                        >
                        <div class="input-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                    </div>
                    <button type="submit" class="auth-btn primary">
                        <i class="fas fa-user-plus"></i>
                        회원가입
                    </button>
                </form>

                <div class="auth-divider">
                    <span>또는</span>
                </div>

                <button class="auth-btn secondary" id="continueAsGuest">
                    <i class="fas fa-user"></i>
                    게스트로 계속하기
                </button>

                <div class="guest-notice">
                    <div class="guest-notice-text">
                        <i class="fas fa-info-circle"></i>
                        게스트로는 감각 정보 조회만 가능합니다
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-modal">
            <div class="tutorial-header">
                <h2><i class="fas fa-graduation-cap"></i> Sensmap 사용법</h2>
            </div>
            <div class="tutorial-content">
                <div class="tutorial-step active" data-step="1">
                    <div class="tutorial-icon">🗺️</div>
                    <h3>지도에서 감각 정보 확인</h3>
                    <p>색상으로 표시된 마커를 통해 각 지역의 소음, 빛, 냄새, 혼잡도 정보를 확인할 수 있습니다. 히트맵과 감각별 보기 모드를 전환해보세요.</p>
                </div>
                <div class="tutorial-step" data-step="2">
                    <div class="tutorial-icon">➕</div>
                    <h3>감각 정보 추가하기</h3>
                    <p>지도를 클릭하고 팝업에서 "감각 정보 추가"를 선택하여 현재 위치의 감각 데이터를 입력하세요. 일시적 또는 지속적 정보를 선택할 수 있습니다.</p>
                </div>
                <div class="tutorial-step" data-step="3">
                    <div class="tutorial-icon">🛣️</div>
                    <h3>감각 친화적 경로 찾기</h3>
                    <p>경로 버튼을 클릭하고 출발지와 도착지를 선택하면 감각 우선, 균형, 시간 우선 등 다양한 경로 옵션을 제공합니다.</p>
                </div>
                <div class="tutorial-step" data-step="4">
                    <div class="tutorial-icon">⚙️</div>
                    <h3>개인 프로필 설정</h3>
                    <p>햄버거 메뉴에서 감각 프로필을 설정하여 개인의 감각 민감도에 맞는 맞춤형 추천을 받으세요. 접근성 옵션도 설정할 수 있습니다.</p>
                </div>
            </div>
            <div class="tutorial-navigation">
                <button class="tutorial-btn secondary" id="tutorialPrev">이전</button>
                <div class="tutorial-dots">
                    <span class="dot active" data-step="1"></span>
                    <span class="dot" data-step="2"></span>
                    <span class="dot" data-step="3"></span>
                    <span class="dot" data-step="4"></span>
                </div>
                <button class="tutorial-btn primary" id="tutorialNext">다음</button>
            </div>
            <button class="tutorial-skip" id="tutorialSkip">건너뛰기</button>
        </div>
    </div>
    
    <!-- 질문 모달 -->
    <div class="modal-overlay" id="questionModal" style="display:none;">
    <div class="modal-content">
        <div class="modal-header">
        <button class="close-btn" id="closeQuestionBtn" aria-label="질문 닫기">
            <i class="fas fa-times"></i>
        </button>
        </div>
<div class="modal-body">
  <p>아래 질문에 답해주세요:</p>

  <div id="surveyWizard" class="survey-wizard">
    <div class="wizard-content">
      <!-- Step 1 -->
      <section class="tutorial-step active" data-step="1">
        <div class="question-block">
          <label for="soundFoodcourt">점심시간에 붐비고 시끄러운 푸드코트에서 얼마나 편안함을 느끼시나요?</label>
          <input type="range" id="soundFoodcourt" name="soundFoodcourt" min="1" max="10" step="1" value="5">
        <img src="./assets/FoodCourt.png" alt="푸드코트" class="range-thumb-img" loading="lazy">
        
        </div>
      </section>

      <!-- Step 2 -->
      <section class="tutorial-step" data-step="2">
        <div class="question-block">
          <label for="soundTraffic">자동차 경적 소리와 사이렌이 울리는 복잡한 거리를 상상해 보세요. 이 소리가 얼마나 당신을 괴롭히나요?</label>
          <input type="range" id="soundTraffic" name="soundTraffic" min="1" max="10" step="1" value="5">
          <img src="./assets/CarSiren.png" alt="푸드코트" class="range-thumb-img" loading="lazy">
        </div>
      </section>

      <!-- Step 3 -->
      <section class="tutorial-step" data-step="3">
        <div class="question-block">
          <label for="soundMinor">도서관이나 조용한 스터디룸에 있을 때, 누군가 펜을 딸깍거리는 소리나 작은 속삭임과 같은 사소한 소리가 얼마나 잘 들리나요?</label>
          <input type="range" id="soundMinor" name="soundMinor" min="1" max="10" step="1" value="5">
          <img src="./assets/Library.png" alt="푸드코트" class="range-thumb-img" loading="lazy">
        </div>
      </section>

      <!-- Step 4 -->
      <section class="tutorial-step" data-step="4">
        <div class="question-block">
          <label for="soundBgm">낮은 볼륨으로 배경 음악이 재생될 때, 집중하거나 긴장을 푸는 데 어려움을 겪으시나요?</label>
          <input type="range" id="soundBgm" name="soundBgm" min="1" max="10" step="1" value="5">
          <img src="./assets/Quiet.png" alt="푸드코트" class="range-thumb-img" loading="lazy">
        </div>
      </section>

      <!-- Step 5 -->
      <section class="tutorial-step" data-step="5">
        <div class="question-block">
          <label for="lightMall">창문이 많고 강렬한 천장 조명이 있는 밝은 쇼핑몰에 들어가는 것에 대해 어떻게 느끼시나요?</label>
          <input type="range" id="lightMall" name="lightMall" min="1" max="10" step="1" value="5">
          <img src="./assets/brightmall.png" alt="푸드코트" class="range-thumb-img" loading="lazy">
        </div>
      </section>

      <!-- Step 6 -->
      <section class="tutorial-step" data-step="6">
        <div class="question-block">
          <label for="lightFlicker">형광등의 깜빡임이나 컴퓨터 화면의 눈부심을 알아차리거나 그로 인해 산만해지나요?</label>
          <input type="range" id="lightFlicker" name="lightFlicker" min="1" max="10" step="1" value="5">
          <img src="./assets/brightlight.png" alt="푸드코트" class="range-thumb-img" loading="lazy">
        </div>
      </section>

      <!-- Step 7 -->
      <section class="tutorial-step" data-step="7">
        <div class="question-block">
          <label for="lightGlare">햇빛이 강한 날, 차에 반사되는 밝은 햇빛을 상상해 보세요. 이것이 당신의 눈에 얼마나 불편함을 주나요?</label>
          <input type="range" id="lightGlare" name="lightGlare" min="1" max="10" step="1" value="5">
          <img src="./assets/carbright.png" alt="푸드코트" class="range-thumb-img" loading="lazy">
        </div>
      </section>

      <!-- Step 8 -->
      <section class="tutorial-step" data-step="8">
        <div class="question-block">
          <label for="lightControl">방에 있을 때 편안함을 느끼기 위해 조명을 제어하는 것이 얼마나 중요합니까?</label>
          <input type="range" id="lightControl" name="lightControl" min="1" max="10" step="1" value="5">
        </div>
      </section>

      <!-- Step 9 -->
      <section class="tutorial-step" data-step="9">
        <div class="question-block">
          <label for="smellStore">베이커리나 향수 가게처럼 강한 향이 나는 가게에 들어갈 때 어떤 영향을 받으시나요?</label>
          <input type="range" id="smellStore" name="smellStore" min="1" max="10" step="1" value="5">
          <img src="./assets/smellStore.png" alt="푸드코트" class="range-thumb-img" loading="lazy">
        </div>
      </section>

      <!-- Step 10 -->
      <section class="tutorial-step" data-step="10">
        <div class="question-block">
          <label for="smellSubtle">누군가의 향수나 근처에서 요리하는 음식 냄새와 같은 미묘한 냄새를 얼마나 잘 알아차리고 반응하나요?</label>
          <input type="range" id="smellSubtle" name="smellSubtle" min="1" max="10" step="1" value="5">
        </div>
      </section>

      <!-- Step 11 -->
      <section class="tutorial-step" data-step="11">
        <div class="question-block">
          <label for="smellUnpleasant">패스트푸드점이나 쓰레기차 옆을 지나가는 것을 상상해 보세요. 그 냄새가 당신의 편안함에 얼마나 영향을 미치나요?</label>
          <input type="range" id="smellUnpleasant" name="smellUnpleasant" min="1" max="10" step="1" value="5">
          <img src="./assets/SmellUnpleasant.png" alt="푸드코트" class="range-thumb-img" loading="lazy">
        </div>
      </section>

      <!-- Step 12 -->
      <section class="tutorial-step" data-step="12">
        <div class="question-block">
          <label for="smellAvoid">특유의 냄새 때문에 특정 공공장소나 공간을 피해야 했던 적이 있나요?</label>
          <input type="range" id="smellAvoid" name="smellAvoid" min="1" max="10" step="1" value="5">
          <img src="./assets/smellAvoid.png" alt="푸드코트" class="range-thumb-img" loading="lazy">
        </div>
      </section>

      <!-- Step 13 -->
      <section class="tutorial-step" data-step="13">
        <div class="question-block">
          <label for="crowdSubway">출퇴근 시간대에 매우 혼잡한 지하철역을 지나가는 것에 대해 어떻게 느끼시나요?</label>
          <input type="range" id="crowdSubway" name="crowdSubway" min="1" max="10" step="1" value="5">
          <img src="./assets/crowdSubway.png" alt="푸드코트" class="range-thumb-img" loading="lazy">
        </div>
      </section>

      <!-- Step 14 -->
      <section class="tutorial-step" data-step="14">
        <div class="question-block">
          <label for="crowdMarket">주말의 붐비는 슈퍼마켓을 상상해 보세요. 많은 사람들과 가까이 있는 것이 얼마나 당신을 괴롭히나요?</label>
          <input type="range" id="crowdMarket" name="crowdMarket" min="1" max="10" step="1" value="5">
        </div>
      </section>

      <!-- Step 15 -->
      <section class="tutorial-step" data-step="15">
        <div class="question-block">
          <label for="crowdCinema">붐비는 엘리베이터나 만원인 영화관에 있는 것이 스트레스나 불안을 유발하나요?</label>
          <input type="range" id="crowdCinema" name="crowdCinema" min="1" max="10" step="1" value="5">
          <img src="./assets/crowdElevator.png" alt="푸드코트" class="range-thumb-img" loading="lazy"> 
        </div>
      </section>

      <!-- Step 16 -->
      <section class="tutorial-step" data-step="16">
        <div class="question-block">
          <label for="crowdContact">붐비는 인도에서 사람들과 부딪히는 것과 같이 우발적인 신체 접촉에 어떻게 반응하나요?</label>
          <input type="range" id="crowdContact" name="crowdContact" min="1" max="10" step="1" value="5">
        </div>
      </section>

      <!-- Step 17 -->
      <section class="tutorial-step" data-step="17">
        <div class="question-block">
          <div class="label-with-icon">
            <img id="noiseShockIcon" src="./assets/mood-5.png" alt="" aria-hidden="true" class="label-icon">
            <label for="noiseShock">
              1부터 10까지의 척도로, 화재 경보나 갑작스러운 굉음과 같이 예상치 못한 큰 소음을 얼마나 잘 참아낼 수 있나요?
              <output id="noiseShockValue" for="noiseShock">5</output>
            </label>
          </div>
          <input type="range" id="noiseShock" name="noiseShock" min="1" max="10" step="1" value="5">
          <img src="./assets/noiseSh.png" alt="푸드코트" class="range-thumb-img" loading="lazy">
        </div>
      </section>

      <!-- Step 18 -->
      <section class="tutorial-step" data-step="18">
        <div class="question-block">
          <div class="label-with-icon">
            <img id="lightFlashIcon" src="./assets/mood-5.png" alt="" aria-hidden="true" class="label-icon">
            <label for="lightFlash">
              1부터 10까지의 척도로, 경찰차나 콘서트 무대의 조명처럼 번쩍이는 불빛이 얼마나 성가시나요?
              <output id="lightFlashValue" for="lightFlash">5</output>
            </label>
          </div>
          <input type="range" id="lightFlash" name="lightFlash" min="1" max="10" step="1" value="5">
        </div>
      </section>

      <!-- Step 19 -->
      <section class="tutorial-step" data-step="19">
        <div class="question-block">
          <div class="label-with-icon">
            <img id="smellIcon" src="./assets/mood-5.png" alt="" aria-hidden="true" class="label-icon">
            <label for="smell">
              1부터 10까지의 척도로, 강하고 낯선 냄새가 나는 밀폐된 공간에 있는 것이 얼마나 압도적인가요?
              <output id="smellValue" for="smell">5</output>
            </label>
          </div>
          <input type="range" id="smell" name="smell" min="1" max="10" step="1" value="5">
        </div>
      </section>

      <!-- Step 20 -->
      <section class="tutorial-step" data-step="20">
        <div class="question-block">
          <div class="label-with-icon">
            <img id="crowdAvoidIcon" src="./assets/mood-5.png" alt="" aria-hidden="true" class="label-icon">
            <label for="crowdAvoid">
              1부터 10까지의 척도로, 혼잡한 지역을 피하기 위해 더 길거나 덜 편리한 경로를 선택할 가능성이 얼마나 됩니까?
              <output id="crowdAvoidValue" for="crowdAvoid">5</output>
            </label>
          </div>
          <input type="range" id="crowdAvoid" name="crowdAvoid" min="1" max="10" step="1" value="5">
        </div>
      </section>
    </div>

    <!-- 모달용 네비게이션: 반드시 wizard 내부에 둔다 -->
    <div class="tutorial-navigation">
      <button class="tutorial-btn secondary" id="surveyPrev">이전</button>
      <div class="tutorial-dots" id="surveyDots"></div>
      <button class="tutorial-btn primary" id="surveyNext">다음</button>
    </div>

    <!-- 마지막 스텝에서만 노출 -->
    <button id="submitAnswerBtn" class="primary-btn" style="margin-top:12px; display:none;">제출</button>
  </div>
</div>

        </div>
    </div>
    </div>


    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <div class="loading-text">지도를 불러오는 중...</div>
        </div>
    </div>

    <div class="error-boundary" id="errorBoundary" style="display: none;">
        <div class="error-content">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>오류가 발생했습니다</h3>
            <p>앱을 불러오는 중 문제가 발생했습니다. 페이지를 새로고침하거나 잠시 후 다시 시도해주세요.</p>
            <button onclick="location.reload()" class="primary-btn">
                <i class="fas fa-sync-alt"></i> 새로고침
            </button>
        </div>
    </div>

    <header class="header-controls">
        <div class="header-left">
            <div class="logo">
                <i class="fas fa-map-marked-alt"></i>
                Sensmap
            </div>
            
            <nav class="hamburger-menu">
                <button class="hamburger-btn" id="hamburgerBtn" aria-label="메뉴 열기" aria-expanded="false">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="hamburger-dropdown" id="hamburgerDropdown" aria-hidden="true">
                    <!-- 사용자 정보 표시 영역 -->
                    <div class="user-info" id="userInfo" style="display: none;">
                        <div class="user-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="user-details">
                            <div class="user-name" id="userName">사용자명</div>
                            <div class="user-email" id="userEmail">user@example.com</div>
                        </div>
                    </div>
                    <div class="menu-separator" id="userSeparator" style="display: none;"></div>
                    
                    <div class="menu-item">
                        <button class="menu-btn" id="profileMenuBtn">
                            <i class="fas fa-user-cog"></i>
                            <span>감각 프로필</span>
                        </button>
                    </div>
                    
                    <!-- 로그인한 사용자만 보이는 메뉴 -->
                    <div class="menu-item auth-required" style="display: none;">
                        <button class="menu-btn" id="myDataBtn">
                            <i class="fas fa-database"></i>
                            <span>내 데이터</span>
                        </button>
                    </div>
                    
                    <div class="menu-separator"></div>
                    <div class="menu-item">
                        <button class="menu-btn" id="settingsBtn">
                            <i class="fas fa-cog"></i>
                            <span>설정</span>
                        </button>
                    </div>
                    <div class="menu-item">
                        <button class="menu-btn" id="helpBtn">
                            <i class="fas fa-question-circle"></i>
                            <span>도움말</span>
                        </button>
                    </div>
                    <div class="menu-item">
                        <button class="menu-btn" id="contactBtn">
                            <i class="fas fa-envelope"></i>
                            <span>문의하기</span>
                        </button>
                    </div>
                    
                    <div class="menu-separator"></div>
                    <!-- 인증 관련 메뉴 -->
                    <div class="menu-item" id="loginMenuItem">
                        <button class="menu-btn" id="loginMenuBtn">
                            <i class="fas fa-sign-in-alt"></i>
                            <span>로그인</span>
                        </button>
                    </div>
                    <div class="menu-item auth-required" style="display: none;" id="logoutMenuItem">
                        <button class="menu-btn" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>로그아웃</span>
                        </button>
                    </div>
                </div>
            </nav>
        </div>
        
        <div class="header-center">
            <div class="display-controls">
                <button id="heatmapBtn" class="display-btn active" title="히트맵 보기">
                    <i class="fas fa-fire"></i> 히트맵
                </button>
                <div class="sensory-filter">
                    <button id="sensoryBtn" class="display-btn" title="감각별 보기">
                        <i class="fas fa-map-pin"></i> 감각별
                    </button>
                    <div id="sensoryDropdown" class="sensory-dropdown">
                         <div class="sensory-option active" data-sensory="all">
                            <span class="sensory-icon">🌍</span> 전체
                        </div>
                        <div class="sensory-option" data-sensory="noise">
                            <span class="sensory-icon">🔊</span> 소음
                        </div>
                        <div class="sensory-option" data-sensory="light">
                            <span class="sensory-icon">💡</span> 빛
                        </div>
                        <div class="sensory-option" data-sensory="odor">
                            <span class="sensory-icon">👃</span> 냄새
                        </div>
                        <div class="sensory-option" data-sensory="crowd">
                            <span class="sensory-icon">👥</span> 혼잡도
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="intensity-control">
                <label for="intensitySlider" style="font-size: 12px; color: #6b7280;">표시 강도</label>
                <input type="range" class="intensity-slider" id="intensitySlider" min="0.3" max="1" step="0.1" value="0.7" aria-label="표시 강도 조절">
                <span id="intensityValue" style="font-size: 12px; font-weight: 600;">0.7</span>
            </div>
        </div>
        
        <div class="header-right">
            <button class="icon-btn active" id="showDataBtn" title="데이터 표시/숨김" aria-label="데이터 표시 토글" aria-pressed="true">
                <i class="fas fa-eye"></i>
            </button>
            <button class="icon-btn" id="routeBtn" title="경로 찾기" aria-label="경로 찾기 모드">
                <i class="fas fa-route"></i>
            </button>
            
            <button class="icon-btn locate-btn" id="locateBtn" title="내 위치 표시/추적">
                <i class="fas fa-location-crosshairs"></i>
            </button>
            
        </div>
    </header>

    <aside class="settings-panel" id="settingsPanel">
        <div class="panel-header">
            <div class="panel-title">설정</div>
            <button class="close-btn" id="closeSettingsBtn" aria-label="설정 패널 닫기">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="panel-content">
            <section class="settings-section">
                <h3>접근성 옵션</h3>
                <div class="setting-option">
                    <label>
                        <input type="checkbox" id="colorBlindMode">
                        <span>색맹 친화 모드</span>
                    </label>
                </div>
                <div class="setting-option">
                    <label>
                        <input type="checkbox" id="highContrastMode">
                        <span>고대비 모드</span>
                    </label>
                </div>
                <div class="setting-option">
                    <label>
                        <input type="checkbox" id="reducedMotionMode">
                        <span>사용자 위치 표시</span>
                    </label>
                </div>
                <div class="setting-option">
                    <label for="textSizeSlider">텍스트 크기</label>
                    <input type="range" class="range-slider" id="textSizeSlider" min="0.8" max="1.5" step="0.1" value="1">
                </div>
            </section>
        </div>
    </aside>

    <div class="modal-overlay" id="contactModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>문의하기</h3>
                <button class="close-btn" id="closeContactBtn" aria-label="문의 모달 닫기">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Sensmap에 대한 의견이나 문의사항이 있으시면 언제든지 연락해주세요. 여러분의 피드백이 더 나은 서비스를 만드는 데 도움이 됩니다.</p>
                <div class="contact-methods">
                    <a href="mailto:support@sensmap.app" class="contact-btn">
                        <i class="fas fa-envelope"></i>
                        이메일로 문의하기
                    </a>
                </div>
            </div>
        </div>
    </div>

    <main id="map" role="application" aria-label="감각 지도" tabindex="0"></main>

    <aside class="side-panel" id="sidePanel" aria-hidden="true">
        <div class="panel-header">
            <div class="panel-title">감각 정보 입력</div>
            <div class="panel-subtitle">현재 위치의 감각 정보를 기록해주세요</div>
            <button class="close-btn" id="closePanelBtn" aria-label="패널 닫기">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="panel-content">
            <!-- 로그인 안내 메시지 (게스트 사용자용) -->
            <div class="auth-notice" id="authNotice" style="display: none;">
                <div class="notice-content">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <h4>로그인이 필요합니다</h4>
                        <p>감각 정보를 등록하려면 로그인해주세요.</p>
                    </div>
                </div>
                <div class="notice-actions">
                    <button class="primary-btn small" onclick="authManager.showLoginModal()">
                        <i class="fas fa-sign-in-alt"></i>
                        로그인하기
                    </button>
                </div>
            </div>

            <form id="sensoryForm" novalidate>
                <div class="form-group">
                    <label class="form-label">정보 유형</label>
                    <div class="type-selector">
                        <div class="type-option selected" data-type="irregular" tabindex="0" role="button" aria-pressed="true">
                            <div class="type-title">⚡ 일시적</div>
                            <div class="type-desc">공사, 이벤트 등<br>(최대 1시간)</div>
                        </div>
                        <div class="type-option" data-type="regular" tabindex="0" role="button" aria-pressed="false">
                            <div class="type-title">🟢 지속적</div>
                            <div class="type-desc">건물, 도로 특성<br>(최대 6시간)</div>
                        </div>
                    </div>
                </div>

                <div class="smart-form-group" data-field="noise">
                    <div class="field-header">
                        <label class="form-label" for="noiseInput">소음 수준</label>
                        <button type="button" class="skip-btn" data-field="noise">건너뛰기</button>
                    </div>
                    <div class="slider-container">
                        <input type="range" class="range-slider" id="noiseInput" name="noise" min="0" max="10" value="5" aria-describedby="noiseHelp">
                        <div class="range-value">5</div>
                    </div>
                    <small id="noiseHelp" style="font-size: 11px; color: #6b7280; margin-top: 4px; display: block;">0: 매우 조용함, 10: 매우 시끄러움</small>
                </div>

                <div class="smart-form-group" data-field="light">
                    <div class="field-header">
                        <label class="form-label" for="lightInput">빛 강도</label>
                        <button type="button" class="skip-btn" data-field="light">건너뛰기</button>
                    </div>
                    <div class="slider-container">
                        <input type="range" class="range-slider" id="lightInput" name="light" min="0" max="10" value="5" aria-describedby="lightHelp">
                        <div class="range-value">5</div>
                    </div>
                    <small id="lightHelp" style="font-size: 11px; color: #6b7280; margin-top: 4px; display: block;">0: 매우 어두움, 10: 매우 밝음</small>
                </div>
                
                <div class="smart-form-group" data-field="odor">
                    <div class="field-header">
                        <label class="form-label" for="odorInput">냄새 정도</label>
                        <button type="button" class="skip-btn" data-field="odor">건너뛰기</button>
                    </div>
                    <div class="slider-container">
                        <input type="range" class="range-slider" id="odorInput" name="odor" min="0" max="10" value="5" aria-describedby="odorHelp">
                        <div class="range-value">5</div>
                    </div>
                    <small id="odorHelp" style="font-size: 11px; color: #6b7280; margin-top: 4px; display: block;">0: 냄새 없음, 10: 매우 강한 냄새</small>
                </div>

                <div class="smart-form-group" data-field="crowd">
                    <div class="field-header">
                        <label class="form-label" for="crowdInput">혼잡도</label>
                        <button type="button" class="skip-btn" data-field="crowd">건너뛰기</button>
                    </div>
                    <div class="slider-container">
                        <input type="range" class="range-slider" id="crowdInput" name="crowd" min="0" max="10" value="5" aria-describedby="crowdHelp">
                        <div class="range-value">5</div>
                    </div>
                    <small id="crowdHelp" style="font-size: 11px; color: #6b7280; margin-top: 4px; display: block;">0: 한적함, 10: 매우 혼잡함</small>
                </div>

                <div class="form-group" id="durationGroup" style="display: none;">
                    <label class="form-label" for="durationInput">
                        예상 지속 시간(분)
                        <span class="optional-badge">선택</span>
                    </label>
                    <input type="number" class="duration-input" id="durationInput" name="duration" min="1" placeholder="예: 30분, 60분 등 (최대 1시간)" aria-describedby="durationHelp">
                    <small id="durationHelp" style="font-size: 11px; color: #6b7280; margin-top: 4px; display: block;">비워두면 기본값이 적용됩니다</small>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="wheelchair" id="wheelchairInput">
                        <span>♿ 휠체어 접근 제약</span>
                    </label>
                </div>

                <button type="submit" class="primary-btn">
                    <i class="fas fa-save"></i>
                    감각 정보 저장
                </button>
                
                <button type="button" class="secondary-btn" id="cancelProfileBtn">
                    <i class="fas fa-times"></i>
                    취소
                </button>
            </form>
        </div>
    </aside>

    <!-- 내 데이터 패널 추가 -->
    <aside class="side-panel" id="myDataPanel" aria-hidden="true">
        <div class="panel-header">
            <div class="panel-title">내 감각 정보</div>
            <div class="panel-subtitle">내가 등록한 감각 데이터를 관리하세요</div>
            <button class="close-btn" id="closeMyDataBtn" aria-label="패널 닫기">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="panel-content">
            <!-- ① 툴바 -->
            <div class="mydata-toolbar" id="myDataToolbar" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(180px, 1fr)); gap:12px; align-items:flex-start; margin-bottom:16px;">
                <div style="display:flex; flex-direction:column; gap:4px;">
                    <label for="mdPeriod" style="font-size:11px; font-weight:600; color:#4b5563;">기간</label>
                    <select id="mdPeriod" class="form-input" style="font-size:13px;">
                        <option value="all">전체 기간</option>
                        <option value="24">최근 24시간</option>
                        <option value="168">최근 7일</option>
                        <option value="720">최근 30일</option>
                    </select>
                </div>
                <div style="display:flex; flex-direction:column; gap:4px;">
                    <label for="mdType" style="font-size:11px; font-weight:600; color:#4b5563;">유형</label>
                    <select id="mdType" class="form-input" style="font-size:13px;">
                        <option value="all">모든 유형</option>
                        <option value="irregular">⚡ 일시적</option>
                        <option value="regular">🟢 지속적</option>
                    </select>
                </div>
                <div style="display:flex; flex-direction:column; gap:4px;">
                    <label for="mdSort" style="font-size:11px; font-weight:600; color:#4b5563;">정렬</label>
                    <select id="mdSort" class="form-input" style="font-size:13px;">
                        <option value="newest">최신순</option>
                        <option value="oldest">오래된순</option>
                        <option value="scoreDesc">개인화 점수↓</option>
                        <option value="scoreAsc">개인화 점수↑</option>
                    </select>
                </div>
            </div>

            <!-- ② 통계 카드 -->
            <div id="myDataStatsBar" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(180px, 1fr)); gap:12px; margin-bottom:16px;">
                <div class="stat-card" style="background:#f9fafb; border-radius:12px; padding:16px; text-align:center; box-shadow:0 8px 18px rgba(15, 23, 42, 0.06);">
                    <div class="stat-number" id="mdTotal" style="font-size:22px; font-weight:700; color:#111827;">-</div>
                    <div class="stat-label" style="font-size:11px; color:#6b7280; margin-top:6px;">총 등록</div>
                </div>
                <div class="stat-card" style="background:#f9fafb; border-radius:12px; padding:16px; text-align:center; box-shadow:0 8px 18px rgba(15, 23, 42, 0.06);">
                    <div class="stat-number" id="mdLast" style="font-size:14px; font-weight:600; color:#111827;">-</div>
                    <div class="stat-label" style="font-size:11px; color:#6b7280; margin-top:6px;">최근 등록</div>
                </div>
            </div>

    <!-- ③ 리스트 컨테이너 -->
    <div id="myDataList" class="mydata-list" style="display:flex; flex-direction:column; gap:10px;">
        <div class="loading-placeholder" style="text-align:center; padding:40px; color:#9ca3af;">
            <i class="fas fa-spinner fa-spin" style="font-size:24px; margin-bottom:8px;"></i>
            <div style="font-size:13px;">데이터를 불러오는 중...</div>
        </div>
    </div>
</div>

    <aside class="side-panel" id="profilePanel" aria-hidden="true">
        <div class="panel-header">
            <div class="panel-title">감각 프로필</div>
            <div class="panel-subtitle">개인 민감도를 설정하여 맞춤형 경로를 찾아보세요</div>
            <button class="close-btn" id="closeProfileBtn" aria-label="패널 닫기">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="panel-content">
            <form id="profileForm">
                <div class="form-group">
                    <label class="form-label" for="noiseThreshold">소음 민감도</label>
                    <div class="slider-container">
                        <input type="range" class="range-slider" id="noiseThreshold" name="noiseThreshold" min="0" max="10" value="5" aria-describedby="noiseThresholdHelp">
                        <div class="range-value">5</div>
                    </div>
                    <small id="noiseThresholdHelp" style="font-size: 11px; color: #6b7280; margin-top: 4px; display: block;">높을수록 소음에 민감함</small>
                </div>

                <div class="form-group">
                    <label class="form-label" for="lightThreshold">빛 민감도</label>
                    <div class="slider-container">
                        <input type="range" class="range-slider" id="lightThreshold" name="lightThreshold" min="0" max="10" value="5" aria-describedby="lightThresholdHelp">
                        <div class="range-value">5</div>
                    </div>
                    <small id="lightThresholdHelp" style="font-size: 11px; color: #6b7280; margin-top: 4px; display: block;">높을수록 밝은 빛에 민감함</small>
                </div>

                <div class="form-group">
                    <label class="form-label" for="odorThreshold">냄새 민감도</label>
                    <div class="slider-container">
                        <input type="range" class="range-slider" id="odorThreshold" name="odorThreshold" min="0" max="10" value="5" aria-describedby="odorThresholdHelp">
                        <div class="range-value">5</div>
                    </div>
                    <small id="odorThresholdHelp" style="font-size: 11px; color: #6b7280; margin-top: 4px; display: block;">높을수록 냄새에 민감함</small>
                </div>

                <div class="form-group">
                    <label class="form-label" for="crowdThreshold">혼잡 민감도</label>
                    <div class="slider-container">
                        <input type="range" class="range-slider" id="crowdThreshold" name="crowdThreshold" min="0" max="10" value="5" aria-describedby="crowdThresholdHelp">
                        <div class="range-value">5</div>
                    </div>
                    <small id="crowdThresholdHelp" style="font-size: 11px; color: #6b7280; margin-top: 4px; display: block;">높을수록 혼잡함에 민감함</small>
                </div>

                <button type="submit" class="primary-btn">
                    <i class="fas fa-user-check"></i>
                    프로필 저장
                </button>
                
                <button type="button" class="secondary-btn" id="cancelProfileBtn">
                    <i class="fas fa-times"></i>
                    취소
                </button>
            </form>
        </div>
    </aside>

    <div class="route-controls" id="routeControls" aria-hidden="true">
        <div class="route-info">
            <div class="route-badge" id="routeStatus">출발지 선택</div>
        </div>
        
        <div class="route-options" id="routeOptions" style="display: none;">
            <button class="route-option-btn" id="sensoryRouteBtn">
                <i class="fas fa-leaf" style="color:#10b981;"></i>
                <div>
                    <div class="route-option-title">감각 우선</div>
                    <div class="route-option-desc">가장 쾌적한 경로</div>
                </div>
            </button>
            <button class="route-option-btn balanced" id="balancedRouteBtn">
                <i class="fas fa-balance-scale" style="color:#f59e0b;"></i>
                <div>
                    <div class="route-option-title">균형</div>
                    <div class="route-option-desc">쾌적함과 시간의 균형</div>
                </div>
            </button>
            <button class="route-option-btn" id="timeRouteBtn">
                <i class="fas fa-clock" style="color:#3b82f6;"></i>
                <div>
                    <div class="route-option-title">시간 우선</div>
                    <div class="route-option-desc">가장 빠른 경로</div>
                </div>
            </button>
        </div>
        
        <button class="secondary-btn" id="cancelRouteBtn">
            <i class="fas fa-times"></i>
            취소
        </button>
    </div>

    <div class="undo-action" id="undoAction" style="display: none;">
        <span class="undo-text">감각 정보가 추가되었습니다</span>
        <button class="undo-btn" id="undoBtn">
            <i class="fas fa-undo"></i>
            실행취소
        </button>
    </div>

    <div class="toast" id="toast" role="alert" aria-live="polite"></div>

    <div class="alert-banner" id="alertBanner" style="display: none;">
        <div class="alert-content">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="alertText"></span>
        </div>
        <button class="alert-close" id="alertClose" aria-label="알림 닫기">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- 외부 라이브러리 스크립트 -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-geosearch@3.11.0/dist/geosearch.umd.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    
<script type="module" src="./script.js"></script>
</body>
</html>
